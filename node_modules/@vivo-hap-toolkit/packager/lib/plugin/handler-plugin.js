"use strict";var _webpackSources=require("webpack-sources");function HandlerPlugin(n){this.options=n}function wrapCode(n,e){if(/\.js$/.test(n))return n.match(/\bapp\.js$/)?new _webpackSources.ConcatSource(`(function(){\n  ${"Y"===process.env.NODE_TEST?'global = typeof window === "undefined" ? global.__proto__  : window ;':""}\n  var manifestJson = ${JSON.stringify(global.framework.manifest)}\n  var createAppHandler = function() {\n    return `,e.assets[n],'\n  };\n  if (typeof window === "undefined") {\n    return createAppHandler();\n  }\n  else {\n    window.createAppHandler = createAppHandler\n    // H5注入manifest以获取features\n    global.manifest = manifestJson;\n  }\n})();'):new _webpackSources.ConcatSource(`(function(){\n  ${"Y"===process.env.NODE_TEST?'global = typeof window === "undefined" ? global.__proto__  : window ;':""}\n  var createPageHandler = function() {\n    return `,e.assets[n],'\n  };\n  if (typeof window === "undefined") {\n    return createPageHandler();\n  }\n  else {\n    window.createPageHandler = createPageHandler\n  }\n})();')}HandlerPlugin.prototype.apply=function(n){const e=this.options.workers;n.hooks.compilation.tap("HandlerPlugin",function(n){n.hooks.optimizeChunkAssets.tapAsync("HandlerPlugin",function(o,t){o.forEach(function(o){o.files.forEach(function(o){if(o.startsWith(e))return;const t=wrapCode(o,n);t&&(n.assets[o]=t)})}),t()})})},module.exports=HandlerPlugin;
//# sourceMappingURL=handler-plugin.js.map
