"use strict";const RE_MEDIA_QUERY=/(?:(only|not)?\s*([^\s()]+)(?:\s*and)?\s*)?(.+)?/i,RE_MEDIA_FEATURE=/^(\(\s*[^()]+\)\s+[a-zA-Z]+\s+)+\(\s*[^()]+\)\s*$|^\(\s*[^()]+\)$/,RE_MQ_DISCRETE_EXPRESSION=/\(\s*([^\s:)]+)\s*(?::\s*([^\s)]+))?\s*\)/,RE_MQ_RANGE_EXPRESSION=/^\((?:([-+]?\d*\.?(?:\d+[a-zA-Z]*|\d+\s*\/\s*\d+))\s*(<|>|<=|>=)?\s*)?(aspect-ratio|resolution|width|height|device-width|device-height)(?:\s*(<|>|<=|>=)?\s*([-+]?\d*\.?(?:\d+[a-zA-Z]*|\d+\s*\/\s*\d+)))?\)$/,mediaQueryTypes=["screen"],featureValidatorMap={height:"number","min-height":"number","max-height":"number",width:"number","min-width":"number","max-width":"number",resolution:"resolution","min-resolution":"resolution","max-resolution":"resolution",orientation:"orientation","aspect-ratio":"ratio","min-aspect-ratio":"ratio","max-aspect-ratio":"ratio","device-height":"number","min-device-height":"number","max-device-height":"number","device-width":"number","min-device-width":"number","max-device-width":"number"},featureValidator={number(e){const t=e.match(/^(\d+)(px)*$/);if(t){if(t[2]){const r=t[1];return{value:r,reason:function(t){return"WARN: 媒体特征 `"+t+"` 的值 `"+e+"` 无需单位, 已自动转为 `"+r+"`"}}}return{value:e}}return{reason:function(t){return"WARN: 媒体特征 `"+t+"` 的值 `"+e+"` 不正确, 必须为 `数值`"}}},resolution:e=>/^\d+(dpi|dppx|dpcm)$/.test(e)?{value:e}:{reason:function(t){return"WARN: 媒体特征 `"+t+"` 的值 `"+e+"` 不正确, 必须为 `数值 + dpi|dppx|dpcm`"}},orientation:e=>/^(portrait|landscape)$/.test(e)?{value:e}:{reason:function(t){return"WARN: 媒体特征 `"+t+"` 的值 `"+e+"` 不正确, 必须为 `portrait | landscape`"}},ratio:e=>/^(\d+\s*\/\s*\d+|\d+\.\d+|\d+)$/.test(e)?{value:e}:{reason:function(t){return"WARN: 媒体特征 `"+t+"` 的值 `"+e+"` 不正确, 必须为 `数值 | 数值/数值`"}}};function parseQuery(e){const t=[];return{result:e.split(",").map(function(e){const r=(e=e.trim()).match(RE_MEDIA_QUERY),n=r[1],i=r[2],a=r[3]||"";if(!a.match(RE_MEDIA_FEATURE))return void t.push("WARN: 媒体特征格式错误");const o={};o.modifier=n,o.type=i?i.toLowerCase():"screen";let u=a.match(/\([^)]+\)/g)||[];return o.expressions=u.map(function(r){const n=new RegExp(`\\)\\s+([a-zA-Z]+)?\\s+${r.replace(/\(/,"\\(").replace(/\)/,"\\)")}`),i=e.match(n);let a="";if(i&&"and"!==(a=i[1])&&"or"!==a)return void t.push("WARN: 媒体特征连接符必须为 and 或者 or");let o=r.match(RE_MQ_DISCRETE_EXPRESSION);return o?{type:"discrete",combineSymbol:a,feature:o[1],value:o[2]}:(o=r.match(RE_MQ_RANGE_EXPRESSION))?{type:"range",combineSymbol:a,beforeValue:o[1],beforeSymbol:o[2],feature:o[3],afterSymbol:o[4],afterValue:o[5]}:void t.push('WARN: 无效的媒体特征表达式: "'+r+'"')}),o}),error:t}}function validateDiscreteValue(e,t,r,n){const i=featureValidator[r](e.value),{value:a,reason:o}=i;let u="";return o&&o&&n.push(o(t)),a&&(u+=`${t}: ${a}`),u}function validateRangeValue(e,t,r,n){function i(e){let i=featureValidator[r](e);const{reason:a,value:o}=i;return a&&n.push(a(t)),o}let{beforeValue:a,beforeSymbol:o,afterSymbol:u,afterValue:s}=e,d=t;if(a){if(!(a=i(a)))return"";d=`${a} ${o} ${d}`}if(s){if(!(s=i(s)))return"";d=`${d} ${u} ${s}`}return d}function validateMediaCondition(e){if(e){const t=[],r=parseQuery(e);if(r.error.length>0)return r.error.forEach(r=>{r+=", 表达式: `"+e+"` 有错误，请检查",t.push(r)}),{reason:t};const n=[];return r.result.forEach(e=>{const{modifier:r,type:i,expressions:a}=e;if(-1===mediaQueryTypes.indexOf(i))return void t.push("WARN: 媒体类型 `"+i+"` 不支持");let o=r?`${r} ${i} and`:`${i} and`;a.forEach(e=>{const{feature:r,combineSymbol:n,type:i}=e,a=featureValidatorMap[r];if(!a)return o="",void t.push("WARN: 媒体特征 `"+r+"` 不支持");let u="";"discrete"===i?u=validateDiscreteValue(e,r,a,t):"range"===i&&(u=validateRangeValue(e,r,a,t)),u?o+=n?` ${n} (${u})`:` (${u})`:o=""}),n.push(o)}),{value:n.join(" or "),reason:t}}return{value:""}}function findMediaClassByCondition(e,t){if(t){return e.find(e=>e.condition===t)}return null}function wrapMediaCode(e,t){return`@media ${t} {\n${e}\n}`}module.exports={validateMediaCondition:validateMediaCondition,findMediaClassByCondition:findMediaClassByCondition,wrapMediaCode:wrapMediaCode};
//# sourceMappingURL=mediaquery.js.map
