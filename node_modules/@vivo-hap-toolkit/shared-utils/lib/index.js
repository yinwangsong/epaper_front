"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.logWarn=logWarn,exports.mkdirsSync=mkdirsSync,exports.getIPv4IPAddress=getIPv4IPAddress,exports.getServerIPAndPort=getServerIPAndPort,exports.getClientIPAddress=getClientIPAddress,exports.stripPrefixForIPV4MappedIPV6Address=stripPrefixForIPV4MappedIPV6Address,exports.outputQRCodeOnTerminal=outputQRCodeOnTerminal,exports.relateCwd=relateCwd,exports.equals=equals,exports.extend=extend,exports.renderString=renderString,exports.KnownError=KnownError,exports.debounce=debounce,exports.setCustomConfig=setCustomConfig,exports.getProjectDslName=getProjectDslName,exports.colorconsole=void 0;var _os=_interopRequireDefault(require("os")),_fs=_interopRequireDefault(require("fs")),_path=_interopRequireDefault(require("path")),_console=require("console"),_chalk=_interopRequireDefault(require("chalk")),_qrcodeTerminal=_interopRequireDefault(require("qrcode-terminal")),_config=_interopRequireDefault(require("../config"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const logLevelMap={};function prependLevel(e,o){if(!logLevelMap[e]){const o=e.toUpperCase().substr(0,4);logLevelMap[e]=o}"string"==typeof o[0]&&o[0].length>1&&"["!==o[0][0]&&(o[0]=`[${logLevelMap[e]}] ${o[0]}`)}let originConsole=global.console,console=_console.Console?new _console.Console(process.stdout,process.stderr):originConsole;const colorconsole={init(e){e&&_console.Console&&(console=new _console.Console(e,e))},trace(...e){prependLevel("trace",e),console.trace(...e)},log(...e){prependLevel("log",e),console.log(_chalk.default.green(...e))},info(...e){prependLevel("info",e),console.info(_chalk.default.green(...e))},warn(...e){prependLevel("warn",e),console.warn(_chalk.default.yellow.bold(...e))},error(...e){prependLevel("error",e),console.error(_chalk.default.red.bold(...e))},throw(...e){throw new Error(_chalk.default.red.bold(...e))}};function logWarn(e,o,r){o&&o.length&&o.forEach(o=>{const t=o.line&&o.column?"\t@"+o.line+":"+o.column:"";r||(o.reason.startsWith("ERROR")?colorconsole.error(e.context,o.reason+t):colorconsole.warn(e.context,o.reason+t))})}function mkdirsSync(e){return!!_fs.default.existsSync(e)||(mkdirsSync(_path.default.dirname(e))?(_fs.default.mkdirSync(e),!0):void 0)}function getIPv4IPAddress(){const e=_os.default.networkInterfaces();let o;for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(e[r].every(e=>!("IPv4"===e.family&&!e.internal&&"127.0.0.1"!==e.address)||(o=e,!1)),void 0!==o)break}return o&&o.address}function getServerIPAndPort(e){return(getIPv4IPAddress()||"127.0.0.1")+`${80===e?"":":"+e}`}function getClientIPAddress(e){return stripPrefixForIPV4MappedIPV6Address(e.headers["x-forwarded-for"]||e.connection&&e.connection.remoteAddress||e.socket&&e.socket.remoteAddress||e.connection&&e.connection.socket&&e.connection.socket.remoteAddress)}function stripPrefixForIPV4MappedIPV6Address(e){return/^::1$/.test(e)&&(e="127.0.0.1"),/^::.{0,4}:(\d{1,3}\.){3}\d{1,3}/.test(e)&&(e=e.replace(/^.*:/,"")),e}function outputQRCodeOnTerminal(e){console.info(`\n生成HTTP服务器的二维码: ${e}`),_qrcodeTerminal.default.generate(e,{small:!0})}function relateCwd(e){const o=_config.default.projectPath;return _path.default.relative(o,e)}function equals(e,o,r,...t){if(r){if(r(e,o,...t))return!0}const n=Object.prototype.toString.call(e);if(n!==Object.prototype.toString.call(o))return!1;if("[object Null]"===n||"[object Undefined]"===n)return!0;if("[object Object]"!==n&&"[object Array]"!==n)return Object(e).toString()===Object(o).toString();const s={};Object.keys(e).forEach(e=>s[e]=!0),Object.keys(o).forEach(e=>s[e]=!0);const l=Object.keys(s);for(let t=0;t<l.length;t++){const n=l[t];if(!equals(e[n],o[n],r,n))return!1}return!0}function extend(e,...o){if("function"==typeof Object.assign)Object.assign(e,...o);else{const r=o.shift();for(const o in r)e[o]=r[o];o.length&&extend(e,...o)}return e}function renderString(e,o){return e.replace(/{{(.*?)}}/gm,(e,r)=>(r=r.trim(),void 0!==o[r]?o[r]:r))}function KnownError(e){const o=new Error(e);return o.name="KnownError",o.__KNOWN=!0,o}function debounce(e,o){let r=null;return function(){const t=this,n=arguments;r&&(clearTimeout(r),r=null),r=setTimeout(function(){e.apply(t,n)},o)}}function setCustomConfig(e,o){e=_config.default.projectPath=e||_config.default.projectPath;const r=_path.default.join(e,"quickapp.config.js");if(_fs.default.existsSync(r)){let e={};try{e=require(r)}catch(e){colorconsole.error(`读取项目自定义配置文件出错: ${e.message}`)}const o=Object.assign(_config.default.server,e.server);Object.assign(_config.default,e,{server:o})}o&&(_config.default.server.port=o)}exports.colorconsole=colorconsole;const illegalExtsList=[".css",".less",".scss",".styl",".sass",".log",".json",".js"].map(e=>"app"+e);function getProjectDslName(e){const o=_fs.default.readdirSync(_path.default.join(e,_config.default.sourceRoot)).filter(e=>/^app\..*/.test(e)&&!illegalExtsList.includes(e));let r;return o&&o[0]?(r=_path.default.extname(o[0]).slice(1),colorconsole.info(`获取到app文件后缀: ${r}`)):colorconsole.error("无法获取正确的app文件后缀"),"ux"===r?"xvm":r}
//# sourceMappingURL=index.js.map
